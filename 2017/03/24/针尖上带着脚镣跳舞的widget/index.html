<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>é’ˆå°–ä¸Šå¸¦ç€è„šé•£è·³èˆçš„widget | Me</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">é’ˆå°–ä¸Šå¸¦ç€è„šé•£è·³èˆçš„widget</h1><a id="logo" href="/.">Me</a><p class="description">äººç”Ÿä½•æ‰€æ±‚ è‡´å¯Œå’Œè‡ªç”±</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">é’ˆå°–ä¸Šå¸¦ç€è„šé•£è·³èˆçš„widget</h1><div class="post-meta">Mar 24, 2017<span> | </span><span class="category"><a href="/categories/Widget/">Widget</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>è‡ªä»iOS 10è‹¹æœç»™widgetåšäº†ä¸€æ¬¡å¤§æ”¹ç‰ˆåï¼Œå¾ˆå¤šäººéƒ½å¼€å‘äº†è‡ªå·±çš„widgetã€‚ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œæ¥å‘Šè¯‰ä½ æ€ä¹ˆå¿«é€Ÿå¼€å‘ä¸€ä¸ªwidgetã€‚æˆ‘çš„è¿™ç¯‡æ–‡ç« ä¹Ÿä¸ä¼šé‡å¤é‚£äº›ç®€å•çš„åˆ›å»ºextensionæ·»åŠ è¯ä¹¦ä¹‹ç±»çš„ä¸œè¥¿ã€‚æˆ‘ä»¬è¦æ·±å…¥åœ°çœ‹ä¸€ä¸‹widgetåˆ°åº•åº”è¯¥åšæˆä»€ä¹ˆæ ·å­ã€‚</p>
<a id="more"></a>
<h2 id="ä½ çœŸçš„äº†è§£widgetçš„å°ºå¯¸å—"><a href="#ä½ çœŸçš„äº†è§£widgetçš„å°ºå¯¸å—" class="headerlink" title="ä½ çœŸçš„äº†è§£widgetçš„å°ºå¯¸å—"></a>ä½ çœŸçš„äº†è§£widgetçš„å°ºå¯¸å—</h2><p>é¦–å…ˆwidgetç”±ä¸¤ç§çŠ¶æ€</p>
<figure class="highlight mm"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, NCWidgetDisplayMode) &#123;</div><div class="line">    NCWidgetDisplayModeCompact, <span class="comment">// Fixed height</span></div><div class="line">    NCWidgetDisplayModeExpanded, <span class="comment">// Variable height</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¤§éƒ¨åˆ†ç½‘ä¸Šçš„æ•™ç¨‹éƒ½ä¼šå‘Šè¯‰ä½ ï¼Œå¦‚æœä½ æƒ³æ”¹widgetçš„é«˜åº¦ï¼Œéƒ½æ˜¯åœ¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ä¸­è¿™ä¹ˆå†™</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)widgetActiveDisplayModeDidChange:(NCWidgetDisplayMode)activeDisplayMode withMaximumSize:(<span class="built_in">CGSize</span>)maxSize &#123;</div><div class="line">    <span class="keyword">if</span> (activeDisplayMode == NCWidgetDisplayModeCompact) &#123;</div><div class="line">        <span class="keyword">self</span>.preferredContentSize = <span class="built_in">CGSizeMake</span>(maxSize.width, <span class="number">110</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">self</span>.preferredContentSize = <span class="built_in">CGSizeMake</span>(maxSize.width, <span class="number">300</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ„æ€å°±ç®—æŠ˜å çŠ¶æ€110ï¼Œå±•å¼€çŠ¶æ€300ã€‚</p>
<p>å› ä¸ºå¦‚æœä½ æŠ˜å çŠ¶æ€å°±ç®—å†™120ï¼Œä¹Ÿä¸€æ ·æ˜¯110çš„é«˜åº¦ï¼Œè¿™ä¸ªé«˜åº¦ä¸ä¼šå˜åŒ–ã€‚å±•å¼€çŠ¶æ€ä¸‹ï¼Œå½“ç„¶è¦å–æ¯”maxSize.heightå°çš„ä¸€ä¸ªå€¼ã€‚é‚£ä¹ˆmaxSizeè¿™ä¸ªå€¼æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>ç„¶è€Œæˆ‘è¦å‘Šè¯‰ä½ ï¼Œ<strong>é«˜åº¦æ ¹æœ¬å°±ä¸æ˜¯ä¸€ä¸ªå›ºå®šå€¼</strong>ï¼å¹¶ä¸”å¯ä»¥è®¤ä¸ºæ˜¯æ— è§„å¾‹çš„ï¼ï¼ï¼</p>
<p>å› ä¸ºï¼Œæ•´ä¸ªwidgetçš„maxSizeé™åˆ¶çš„<strong>ç¬¬ä¸€è§„åˆ™æ˜¯æ ¹æ®ç³»ç»Ÿå­—ä½“å¤§å°å˜åŒ–</strong>ã€‚</p>
<p>æ— è®ºæ˜¯æŠ˜å çŠ¶æ€è¿˜æ˜¯å±•å¼€çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç›´æ¥å†™æ­»110æ˜¯é”™è¯¯çš„ã€‚å› ä¸ºé»˜è®¤ç³»ç»Ÿå­—ä½“ä¸‹ï¼Œçš„ç¡®æŠ˜å é«˜åº¦æ˜¯110ã€‚ä½†æ˜¯ä¸€æ—¦ç³»ç»Ÿå­—ä½“æ”¹ä¸ºæœ€å°ï¼Œ<strong>widgetæŠ˜å çŠ¶æ€çš„é«˜åº¦ä»…ä¸º95</strong>ï¼Œè€Œåœ¨ç³»ç»Ÿå­—ä½“æœ€å¤§çš„æƒ…å†µä¸‹ï¼ŒwidgetæŠ˜å çŠ¶æ€çš„é«˜åº¦æ˜¯140ã€‚è€Œç³»ç»Ÿå­—ä½“å¤§å°ä¸€å…±æœ‰7æ¡£ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>æŠ˜å é«˜åº¦å’Œå­—ä½“å¤§å°ç›¸å…³ï¼Œä½†ä¸æ˜¯çº¿æ€§ç›¸å…³</strong>ã€‚</p>
<p>å¯ä»¥éªŒè¯ï¼Œ<strong>æŠ˜å çš„é«˜åº¦æ˜¯95-100-105-110-120-135-140è¿™ä¸ƒæ¡£</strong>ã€‚ä¸”ä¸å¯ä¿®æ”¹ã€‚</p>
<p>å…‰æŠ˜å é«˜åº¦ä¹Ÿå°±ç®—äº†ã€‚<strong>å±•å¼€æœ€å¤§é«˜åº¦ä¹Ÿæ˜¯ä¸€ä¸ªéçº¿æ€§ç›¸å…³çš„é«˜åº¦ï¼ˆå¹¶ä¸”æ˜¯åœ¨æŠ˜å é«˜åº¦ç»Ÿä¸€çš„æƒ…å†µä¸‹ï¼‰</strong>ã€‚</p>
<p>ä»¥ä¸‹å¯¹äºå±•å¼€é«˜åº¦çš„è®¨è®ºï¼Œéƒ½å›ºå®šç³»ç»Ÿå­—ä½“å¤§å°ä¸ºé»˜è®¤å¤§å°ï¼Œæ§åˆ¶å˜é‡ï¼ˆ<strong>æœ€ç»ˆå¾—å‡ºçš„å°ºå¯¸ç»“æœï¼Œç†è®ºä¸Šä¹˜ä»¥7å°±æ˜¯æ‰€æœ‰å¯èƒ½çš„é«˜åº¦</strong>ï¼‰ã€‚</p>
<p>é¦–å…ˆå°±æ˜¯æœºå‹çš„å·®å¼‚ï¼Œå½“ç„¶æ‰‹æœºå±å¹•è¶Šå°ï¼Œå±•å¼€æœ€å¤§é«˜åº¦ä¹Ÿå°±è¶Šå°ï¼Œè¿™ä¸ªå…¶å®å°šå¯ä»¥æ¥å—ã€‚å¤§ä¸äº†æˆ‘ä»¬æŒ‰ç…§æœ€å°å±å¹•çš„æƒ…å†µå¼€å‘å‘—ã€‚ç„¶è€Œï¼Œæˆ‘è¦å‘Šè¯‰ä½ ï¼Œwidgetæœ€å¤§é«˜åº¦è¿˜æ˜¯ä¼šå˜ï¼</p>
<p>è¿™ä¸ªæ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„widgetå…¥å£ï¼Œå°±æ˜¯å±å¹•å·¦æ»‘çš„Todayé¡µ</p>
<p><img src="http://oo6vl10at.bkt.clouddn.com/2017-03-24-1.png" alt=""></p>
<p>ç„¶è€Œå…¶å®è¿˜æœ‰å¦å¤–ä¸€ä¸ªå…¥å£ï¼Œå°±æ˜¯ä¸‹æ‹‰é€šçŸ¥é¡µçš„å·¦æ»‘ï¼Œä¹Ÿä¼šæœ‰å…¥å£</p>
<p><img src="http://oo6vl10at.bkt.clouddn.com/2017-03-24-2.png" alt=""></p>
<p>è¿™ä¸¤ä¸ªå…¥å£è¿›æ¥ï¼Œ<strong>widgetå±•å¼€çŠ¶æ€çš„æœ€å¤§é«˜åº¦ï¼Œåè€…ä¼šæ¯”å‰è€…å°å¾ˆå¤š</strong>ï¼</p>
<p>æ‰“æ–­ç‚¹çœ‹maxSizeå¾ˆå®¹æ˜“å°±å¯ä»¥éªŒè¯ï¼ŒiPhone7é»˜è®¤å­—ä½“å¤§å°ï¼Œå±•å¼€çŠ¶æ€ä¸‹ã€‚<strong>ç¬¬ä¸€ä¸ªå…¥å£çš„maxSize.heightæ˜¯616ï¼Œè€Œå¦å¤–ä¸€ä¸ªæƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ•°å€¼å˜æˆäº†528</strong>ã€‚</p>
<p><strong>æ­¤æ—¶çœŸæƒ³é—®ä¸€å£°è‹¹æœçˆ¸çˆ¸ï¼Œè¿™åˆ°åº•æ˜¯æƒ³æå•¥ï¼Ÿ</strong></p>
<p><em>å…¶å®è¿˜æœ‰ç¬¬ä¸‰ä¸ªå…¥å£ï¼Œå°±æ˜¯3D touch appå›¾æ ‡ï¼Œä¹Ÿä¼šå‡ºç°widgetï¼Œä½†æ˜¯é‚£ä¸ªåªæœ‰æŠ˜å çŠ¶æ€</em></p>
<p><img src="http://oo6vl10at.bkt.clouddn.com/2017-03-24-3.png" alt=""></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç›®å‰æ¥çœ‹ï¼Œ<strong>æŠ˜å çŠ¶æ€æ˜¯7ç§å°ºå¯¸ï¼Œè€Œæ¯ç§å±å¹•å¤§å°çš„å±•å¼€çŠ¶æ€ä¸‹å°±æ˜¯7*2ç§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ4å‹ï¼Œ4.7å‹ï¼Œ5.5å‹è¿™ä¸‰ç§ä¸»æµå±å¹•å°ºå¯¸éƒ½è¦é€‚é…çš„è¯ï¼Œå±•å¼€çŠ¶æ€æ˜¯7*2*3=42ç§å°ºå¯¸</strong>ã€‚</p>
<p>çœ‹åˆ°è¿™ä½ å¯ä»¥è¯´ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘å°±å–4å‹è®¾å¤‡æœ€å°çš„é«˜åº¦ã€‚è¿™ä¸ªå°±è¦çœ‹ä½ çš„è®¾è®¡å¸ˆèƒ½ä¸èƒ½åŒæ„äº†ã€‚</p>
<p>ä½ ä»¥ä¸ºå®Œäº†å—ï¼Ÿåˆ«è¯´iPadå‘¢ï¼Œé‚£ä¸ªå’±ä»¬å°±ä¸è€ƒè™‘äº†ï¼ŒiPhoneèƒ½æ”¾ä¸‹ï¼ŒiPadå½“ç„¶ä¹Ÿæ”¾å¾—ä¸‹ã€‚</p>
<p>ä½†æ˜¯ä½ çœŸçš„æƒ³ä¸åˆ°ï¼Œ5.5å‹ä¹Ÿå°±æ˜¯<strong>Plusæœºå‹çš„æ¨ªå±çŠ¶æ€</strong>ï¼Œä¹Ÿæ˜¯ä¸åŒå°ºå¯¸çš„ã€‚<strong>Plusæ¨ªå±ä¸‹çš„å±•å¼€æ¨¡å¼ï¼Œç¬¬ä¸€ä¸ªå…¥å£æœ€å¤§é«˜åº¦ä»…æœ‰352ï¼Œç¬¬äºŒå…¥å£çš„æœ€å¤§é«˜åº¦ä»…264</strong>â€¦â€¦</p>
<p>æ„å‘³ç€ä»€ä¹ˆï¼Œæœ€å¤§å­—ä½“æƒ…å†µä¸‹çš„æŠ˜å çŠ¶æ€éƒ½æœ‰140é«˜åº¦ï¼Œå±•å¼€è¿˜ä¸åˆ°æŠ˜å é«˜åº¦çš„ä¸¤å€ã€‚</p>
<p><strong>å¦‚æœä½ å¯¹widgetçš„å°ºå¯¸é€‚é…æ„Ÿå…´è¶£ï¼Œå¹¶ä¸”æœ‰è§£å†³æ–¹æ¡ˆï¼Œè¯·è”ç³»æˆ‘ï¼Œå¿…æœ‰é‡è°¢ã€‚</strong></p>
<h2 id="æœ‰æ²¡æœ‰æ„Ÿè§‰è¢«é—ªçäº†"><a href="#æœ‰æ²¡æœ‰æ„Ÿè§‰è¢«é—ªçäº†" class="headerlink" title="æœ‰æ²¡æœ‰æ„Ÿè§‰è¢«é—ªçäº†"></a>æœ‰æ²¡æœ‰æ„Ÿè§‰è¢«é—ªçäº†</h2><p>ä½ å¦‚æœæ·»åŠ äº†å¾ˆå¤šä¸ªwidgetå°±ä¼šå‘ç°ï¼Œå°±å•å•åœ¨åˆ—è¡¨é‡Œä¸Šä¸‹æ»‘åŠ¨éƒ½èƒ½æŠŠçœ¼ç›é—ªçã€‚</p>
<p><img src="http://oo6vl10at.bkt.clouddn.com/2017-03-24-4.gif?imageView2/0/w/400/ignore-error/1" alt=""></p>
<p>Widget è‡ªèº«çš„æ›´æ–°æœºåˆ¶ï¼Œæ˜¯è¿›å…¥åˆ° Widget åï¼Œå…ˆæ‰§è¡Œ viewDidLoad æ–¹æ³•ï¼Œç„¶åæ˜¯ viewWillAppear æ–¹æ³•ã€‚</p>
<p>ä½†æ˜¯ç»æµ‹éªŒï¼Œæ¯å½“æŸä¸€ä¸ªWidgetåœ¨ä¸Šä¸‹æ»‘åŠ¨ï¼Œæ»‘å‡ºå±å¹•åï¼Œå†æŠŠè¿™ä¸ªwidgetåˆ’å›æ¥ï¼Œå°±èµ°ä¸Šé¢é‚£ä¸€å¥—åˆ·æ–°æœºåˆ¶ã€‚</p>
<p>ç”±äºä»¥ä¸Šç‰¹æ€§ï¼Œæ›´æ–°ä»£ç æœ€å¥½å†™åœ¨ viewWillAppear æ–¹æ³•é‡Œé¢ï¼Œå¯¹äºæ›´æ–°æ—¶æ•ˆæ€§ç‰¹åˆ«å¼ºçš„ï¼Œæ¯”å¦‚å¤©æ°”ç±» appï¼Œè¿™ç§æœ€å¥½å°±æ˜¯åœ¨è¯¥æ–¹æ³•é‡Œé¢æ·»åŠ ä¸€ä¸ª NSTimer å®šæ—¶è¿›è¡Œåˆ·æ–°ï¼Œåœ¨ viewWillDisAppear æ–¹æ³•ä¸­ è¿›è¡Œ å–æ¶ˆNSTimer invalidateå®šæ—¶æ›´æ–°å³å¯ã€‚</p>
<p>æˆ–è€…ï¼Œä½ è‡ªå·±å®ç°ç¼“å­˜ï¼Œä¸€æ ·å¯ä»¥ä¼˜åŒ–ã€‚åˆ¤æ–­å¦‚æœè¯·æ±‚æ¥çš„æ•°æ®å’Œå½“å‰æ•°æ®å†…å®¹ä¸€è‡´ï¼Œé‚£ä¹ˆå°±ä¸è¿›è¡Œåˆ·æ–°åˆ—è¡¨æ“ä½œã€‚</p>
<p>çŸ¥ä¹ã€å¾—åˆ° ç­‰ç­‰å¥½å¤šappçš„ Widgetï¼Œåªè¦èµ° viewDidLoad æ–¹æ³•å°±ä¼šé—ªä¸€ä¸‹ï¼Œå› ä¸ºæ¯æ¬¡WidgetåŠ è½½è¯·æ±‚çš„æ•°æ®åä¼šè¿›è¡Œæ›¿æ¢é€ æˆçš„ã€‚</p>
<p>è‡³äºä¸ºä»€ä¹ˆåªè¦ä¸å†è§†çº¿èŒƒå›´å†å›æ¥å°±åˆ·æ–°ï¼Œæˆ‘çŒœæµ‹ï¼Œæ˜¯å› ä¸ºå†…å­˜é—®é¢˜ã€‚</p>
<p>widgetå¯¹å†…å­˜çš„è¦æ±‚ä¹‹é«˜ä»¤äººå‘æŒ‡ï¼Œä½ çš„widgetä¸­ä¸€æ—¦æœ‰gifï¼ŒåŸºæœ¬ä¸Šå°±å®Œå…¨æ²¡æœ‰åŠæ³•æ˜¾ç¤ºï¼Œè¿‡ä¸€ä¼šå°±ä¼šæ˜¾ç¤ºæ— æ³•è½½å…¥ã€‚ä¸ä»…å¦‚æ­¤ï¼Œåå¤æ¥å›æ»šåŠ¨widgeté¡µé¢ï¼Œä»¥ä¸æ–­åˆ·æ–°ä¹Ÿä¼šå¯¼è‡´å ç”¨å†…å­˜å‡é«˜ï¼Œä¸å¤ªæ¸…æ¥šè¿™ä¸ªæ˜¯ä¸æ˜¯è‹¹æœçš„BUGï¼Œä½†æ˜¯æˆ‘è‡ªå·±çš„æµ‹è¯•ä¸­ï¼Œ<strong>å°½é‡éƒ½è®©å•ä¸ªçš„widgetå†…å­˜å ç”¨å°äº15Mï¼Œè¿™æ ·è¢«æ€æ‰å†…å­˜çš„æœºä¼šå¾ˆå°</strong>ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘åœ¨å¼€å‘çš„æ—¶å€™ï¼Œgifå›¾éƒ½åªå–ç¬¬ä¸€å¸§ã€‚å¹¶ä¸”å°½å¯èƒ½ä¸ä¸»åŠ¨åˆ·æ–°UIï¼Œä¿æŒwidgetå†…å­˜å¤„äºä¸€ä¸ªè¾ƒä½çš„æ°´å¹³ã€‚</p>
<p>è€Œä¸”ç”±äºextensionå®é™…ä¸Šä¸èƒ½ç›´æ¥ä½¿ç”¨ä¸»targetä¸­çš„é‚£äº›æ¡†æ¶ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä¹Ÿå†™äº†ä¸€äº›æœ€åŸºæœ¬çš„åŠŸèƒ½ç»„ä»¶ã€‚</p>
<p>é¦–å…ˆå½“ç„¶æ˜¯ç¼“å­˜ç³»ç»Ÿï¼Œå›¾ç‰‡ç¼“å­˜å°¤å…¶å…³é”®ï¼Œå› ä¸ºwidgetè¿™ç§ç‰¹æ€§ï¼Œä¼šåå¤åˆ·æ–°ï¼Œå¦‚æœæ²¡æœ‰ç¼“å­˜ç³»ç»Ÿï¼Œæ˜¯éå¸¸å¤§çš„æµªè´¹ã€‚é¦–å…ˆå°±æ˜¯å›¾ç‰‡ç¼“å­˜ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"QDTEImageCache.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;CommonCrypto/CommonDigest.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">QDTEImageCache</span></span></div><div class="line"></div><div class="line">+ (<span class="keyword">instancetype</span>)shareImageCache &#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> once;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">id</span> instance;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;once, ^&#123;</div><div class="line">        instance = [<span class="keyword">self</span> new];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> instance;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)isExistCacheForKey:(<span class="built_in">NSString</span> *)key &#123;</div><div class="line">    key = [<span class="keyword">self</span> cachedFileNameForKey:key];</div><div class="line">    <span class="built_in">NSString</span> *filePath = [[<span class="keyword">self</span> getCachePath] stringByAppendingPathComponent:key];</div><div class="line">    <span class="keyword">return</span> [[<span class="built_in">NSFileManager</span> defaultManager] fileExistsAtPath:filePath];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSData</span> *)getImageDataForKey:(<span class="built_in">NSString</span> *)key &#123;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span> isExistCacheForKey:key]) &#123;</div><div class="line">        <span class="keyword">return</span> [<span class="built_in">NSData</span> dataWithContentsOfFile:[[<span class="keyword">self</span> getCachePath] stringByAppendingPathComponent:[<span class="keyword">self</span> cachedFileNameForKey:key]]];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)saveToCacheWithData:(<span class="built_in">NSData</span> *)data forKey:(<span class="built_in">NSString</span> *)key &#123;</div><div class="line">    key = [<span class="keyword">self</span> cachedFileNameForKey:key];</div><div class="line">    <span class="built_in">NSString</span> *filePath = [[<span class="keyword">self</span> getCachePath] stringByAppendingPathComponent:key];</div><div class="line">    </div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</div><div class="line">        [data writeToFile:filePath atomically:<span class="literal">YES</span>];</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)getCachePath &#123;</div><div class="line">    <span class="built_in">NSFileManager</span> *fileMgr = [<span class="built_in">NSFileManager</span> defaultManager];</div><div class="line">    <span class="built_in">NSString</span> *containerPath = [[fileMgr containerURLForSecurityApplicationGroupIdentifier:<span class="string">@"group.com.XXXXXXX"</span>] path];</div><div class="line">    </div><div class="line">    <span class="built_in">NSString</span> *path = [containerPath stringByAppendingString:<span class="string">@"/Caches/"</span>];</div><div class="line">    <span class="keyword">if</span> (![fileMgr fileExistsAtPath:path]) &#123;</div><div class="line">        <span class="built_in">BOOL</span> res = [fileMgr createDirectoryAtPath:path</div><div class="line">                      withIntermediateDirectories:<span class="literal">YES</span></div><div class="line">                                       attributes:<span class="literal">nil</span></div><div class="line">                                            error:<span class="literal">nil</span>];</div><div class="line">        <span class="keyword">if</span> (!res) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> path;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)cachedFileNameForKey:(<span class="built_in">NSString</span> *)key &#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *str = [key UTF8String];</div><div class="line">    <span class="keyword">if</span> (str == <span class="literal">NULL</span>) &#123;</div><div class="line">        str = <span class="string">""</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> r[CC_MD5_DIGEST_LENGTH];</div><div class="line">    CC_MD5(str, (CC_LONG)strlen(str), r);</div><div class="line">    <span class="built_in">NSString</span> *filename = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%@"</span>,</div><div class="line">                          r[<span class="number">0</span>], r[<span class="number">1</span>], r[<span class="number">2</span>], r[<span class="number">3</span>], r[<span class="number">4</span>], r[<span class="number">5</span>], r[<span class="number">6</span>], r[<span class="number">7</span>], r[<span class="number">8</span>], r[<span class="number">9</span>], r[<span class="number">10</span>],</div><div class="line">                          r[<span class="number">11</span>], r[<span class="number">12</span>], r[<span class="number">13</span>], r[<span class="number">14</span>], r[<span class="number">15</span>], [[key pathExtension] isEqualToString:<span class="string">@""</span>] ? <span class="string">@""</span> : [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@".%@"</span>, [key pathExtension]]];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> filename;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>ä¸€ä¸ªéå¸¸åŸºç¡€çš„å›¾ç‰‡ç¼“å­˜ï¼ŒåŒæ—¶é…åˆæ–‡ä»¶ç®¡ç†ç±», æ¥ç®¡ç†æ¥å£è¿”å›çš„responseï¼š</p>
<p>æ§åˆ¶å™¨å‘å‡ºçš„è¯·æ±‚ï¼Œæ”¶åˆ°responseçš„dataæ—¶åšä¸€æ¬¡ç¼“å­˜å¹¶æ¯”å¯¹</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask didReceiveData:(<span class="built_in">NSData</span> *)data &#123;</div><div class="line">    [<span class="keyword">self</span>.jsonData appendData:data];</div><div class="line">    <span class="built_in">NSDictionary</span> *dic = [[<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:<span class="keyword">self</span>.jsonData options:<span class="built_in">NSJSONReadingMutableContainers</span> error:<span class="literal">nil</span>] <span class="keyword">copy</span>];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (dic == <span class="literal">nil</span>) <span class="keyword">return</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">self</span>.jsonData = <span class="literal">nil</span>;</div><div class="line">    </div><div class="line">    <span class="built_in">NSDictionary</span> *metaDic = [dic valueForKey:<span class="string">@"meta"</span>];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> ([[metaDic valueForKey:<span class="string">@"status"</span>] integerValue] == <span class="number">200</span>) &#123;</div><div class="line">        </div><div class="line">        <span class="built_in">NSArray</span> *papers = [[dic valueForKey:<span class="string">@"response"</span>] valueForKey:<span class="string">@"papers"</span>];</div><div class="line">        <span class="built_in">NSDictionary</span> *paperDic = [papers firstObject];</div><div class="line">        </div><div class="line">        [_fileMgr saveToCacheWithRawDic:paperDic];</div><div class="line">        </div><div class="line">        QDTELabModel *labModle = [<span class="keyword">self</span> modelFromRawDic:paperDic];</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (labModle.article_id.longValue == <span class="keyword">self</span>.labModel.article_id.longValue) <span class="keyword">return</span>;</div><div class="line">        </div><div class="line">        <span class="keyword">self</span>.labModel = labModle;</div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">            <span class="keyword">for</span> (<span class="built_in">UIView</span> *subView <span class="keyword">in</span> <span class="keyword">self</span>.view.subviews) &#123;</div><div class="line">                [subView removeFromSuperview];</div><div class="line">            &#125;</div><div class="line">            [<span class="keyword">self</span> refreshContentView];</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ–‡ä»¶ç®¡ç†ç±»ç”¨æ¥å‚¨å­˜</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"QDTEFileManager.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">QDTEFileManager</span></span></div><div class="line">+ (<span class="keyword">instancetype</span>)shareManager &#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> once;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">id</span> instance;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;once, ^&#123;</div><div class="line">        instance = [<span class="keyword">self</span> new];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> instance;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSDictionary</span> *)getUserinfo &#123;</div><div class="line">    <span class="built_in">NSFileManager</span> *fileMgr = [<span class="built_in">NSFileManager</span> defaultManager];</div><div class="line">    <span class="built_in">NSString</span> *containerPath = [[fileMgr containerURLForSecurityApplicationGroupIdentifier:<span class="string">@"group.com.XXXXXX"</span>] path];</div><div class="line">    </div><div class="line">    <span class="built_in">NSString</span> *filePath = [containerPath stringByAppendingPathComponent:<span class="string">@"QDUserinfo.json"</span>];</div><div class="line">    <span class="keyword">if</span> ([fileMgr fileExistsAtPath:filePath]) &#123;</div><div class="line">        <span class="built_in">NSError</span> *error;</div><div class="line">        <span class="keyword">return</span> [[<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:[<span class="built_in">NSData</span> dataWithContentsOfFile:filePath] options:<span class="built_in">NSJSONReadingMutableContainers</span> error:&amp;error] <span class="keyword">copy</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSDictionary</span> *)getRawDicFromCache &#123;</div><div class="line">    <span class="built_in">NSFileManager</span> *fileMgr = [<span class="built_in">NSFileManager</span> defaultManager];</div><div class="line">    <span class="built_in">NSString</span> *containerPath = [[fileMgr containerURLForSecurityApplicationGroupIdentifier:<span class="string">@"group.com.XXXXXX"</span>] path];</div><div class="line">    <span class="built_in">NSString</span> *path = [containerPath stringByAppendingString:<span class="string">@"/Caches/"</span>];</div><div class="line">    <span class="built_in">NSString</span> *filePath = [path stringByAppendingPathComponent:<span class="string">@"QDLabCache.json"</span>];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> ([fileMgr fileExistsAtPath:filePath]) &#123;</div><div class="line">        <span class="built_in">NSError</span> *error;</div><div class="line">        <span class="built_in">NSDictionary</span> *rawDic = [[<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:[<span class="built_in">NSData</span> dataWithContentsOfFile:filePath] options:<span class="built_in">NSJSONReadingMutableContainers</span> error:&amp;error] <span class="keyword">copy</span>];</div><div class="line">        <span class="keyword">return</span> rawDic;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)saveToCacheWithRawDic:(<span class="built_in">NSDictionary</span> *)rawDic &#123;</div><div class="line">    <span class="built_in">NSFileManager</span> *fileMgr = [<span class="built_in">NSFileManager</span> defaultManager];</div><div class="line">    <span class="built_in">NSString</span> *containerPath = [[fileMgr containerURLForSecurityApplicationGroupIdentifier:<span class="string">@"group.com.XXXXXX"</span>] path];</div><div class="line">    </div><div class="line">    <span class="built_in">NSString</span> *path = [containerPath stringByAppendingString:<span class="string">@"/Caches/"</span>];</div><div class="line">    <span class="built_in">BOOL</span> res = [fileMgr createDirectoryAtPath:path</div><div class="line">                  withIntermediateDirectories:<span class="literal">YES</span></div><div class="line">                                   attributes:<span class="literal">nil</span></div><div class="line">                                        error:<span class="literal">nil</span>];</div><div class="line">    <span class="keyword">if</span> (!res) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSString</span> *filePath = [path stringByAppendingPathComponent:<span class="string">@"QDLabCache.json"</span>];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> ([<span class="built_in">NSJSONSerialization</span> isValidJSONObject:rawDic])</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">NSError</span> *error;</div><div class="line">        <span class="built_in">NSData</span> *jsonData = [<span class="built_in">NSJSONSerialization</span> dataWithJSONObject:rawDic</div><div class="line">                                                           options:<span class="built_in">NSJSONWritingPrettyPrinted</span></div><div class="line">                                                             error:&amp;error];</div><div class="line">        </div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</div><div class="line">            [jsonData writeToFile:filePath atomically:<span class="literal">YES</span>];</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)getServerIP</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span> getDEBUG]) &#123;</div><div class="line">        <span class="built_in">NSFileManager</span> *fileMgr = [<span class="built_in">NSFileManager</span> defaultManager];</div><div class="line">        <span class="built_in">NSString</span> *containerPath = [[fileMgr containerURLForSecurityApplicationGroupIdentifier:<span class="string">@"group.com.XXXXXX"</span>] path];</div><div class="line">        </div><div class="line">        <span class="built_in">NSString</span> *filePath = [containerPath stringByAppendingPathComponent:<span class="string">@"QDServerIP.json"</span>];</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> ([fileMgr fileExistsAtPath:filePath]) &#123;</div><div class="line">            <span class="built_in">NSError</span> *error;</div><div class="line">            <span class="built_in">NSArray</span> *serverIPArr = [[<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:[<span class="built_in">NSData</span> dataWithContentsOfFile:filePath] options:<span class="built_in">NSJSONReadingMutableContainers</span> error:&amp;error] <span class="keyword">copy</span>];</div><div class="line">            <span class="keyword">return</span> serverIPArr.firstObject;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="string">@"http://app3.qdaily.com"</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)getDEBUG &#123;</div><div class="line"><span class="meta">#ifdef DEBUG</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line"><span class="meta">#elif BETA</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line"><span class="meta">#else</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line"><span class="meta">#endif</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<hr>
<p>æœ€åå‘¢ï¼Œè¿™ä¸ªæ˜¯æˆ‘å…¶ä¸­ä¸€ä¸ªwidgetçš„æ–‡ä»¶ç»“æ„ã€‚</p>
<p><img src="http://oo6vl10at.bkt.clouddn.com/2017-03-24-5.png" alt=""></p>
<p>widgetè™½å°ï¼Œä½†æ˜¯æˆ‘å½“æ—¶åœ¨å¼€å‘çš„æ—¶å€™è¿˜æ˜¯å°½é‡æƒ³æ€ä¹ˆå¤æ‚æ€ä¹ˆåšï¼Œæ¯•ç«Ÿè¿™ç§ä¸œè¥¿ï¼Œå¼€å‘ä¸€æ¬¡ï¼Œå‡ ä¹ä»¥åå†ä¹Ÿä¸ä¼šå»åŠ¨äº†ã€‚æ¯•ç«Ÿâ€¦â€¦<strong>é’ˆå°–ä¸Šè¿˜è¦å¸¦ç€è„šé•£è·³èˆå®åœ¨å¤ªç´¯äº†</strong>ğŸ˜‚ã€‚</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://suntao.me/2017/03/24/é’ˆå°–ä¸Šå¸¦ç€è„šé•£è·³èˆçš„widget/" data-id="cj1dhj6sd0006arfyr2bedrow" class="article-share-link">åˆ†äº«åˆ°</a><div class="tags"><a href="/tags/iOS10-Widget/">iOS10 Widget</a></div><div class="post-nav"><a href="/2017/03/14/ä»-propertyè¯´èµ·ï¼ˆå››ï¼‰æ·±å…¥æˆå‘˜å˜é‡/" class="pre">ä»@propertyè¯´èµ·ï¼ˆå››ï¼‰æ·±å…¥æˆå‘˜å˜é‡</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://suntao.me"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€æ–°æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/03/24/é’ˆå°–ä¸Šå¸¦ç€è„šé•£è·³èˆçš„widget/">é’ˆå°–ä¸Šå¸¦ç€è„šé•£è·³èˆçš„widget</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/14/ä»-propertyè¯´èµ·ï¼ˆå››ï¼‰æ·±å…¥æˆå‘˜å˜é‡/">ä»@propertyè¯´èµ·ï¼ˆå››ï¼‰æ·±å…¥æˆå‘˜å˜é‡</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/09/ä»-propertyè¯´èµ·ï¼ˆä¸‰ï¼‰atomicä¸å¤šçº¿ç¨‹é”/">ä»@propertyè¯´èµ·ï¼ˆä¸‰ï¼‰atomicä¸å¤šçº¿ç¨‹é”</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/21/ä»-propertyè¯´èµ·ï¼ˆäºŒï¼‰å½“æˆ‘ä»¬å†™ä¸‹-property-nonatomic-weak-id-objæ—¶ï¼Œæˆ‘ä»¬ç©¶ç«Ÿå†™äº†ä»€ä¹ˆ/">ä»@propertyè¯´èµ·ï¼ˆäºŒï¼‰weakå…³é”®å­—</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/20/ä»@propertyè¯´èµ·ï¼ˆä¸€ï¼‰å¼€é¢˜ç¯‡/">ä»@propertyè¯´èµ·ï¼ˆä¸€ï¼‰å¼€é¢˜ç¯‡</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/13/iOS å®¢æˆ·ç«¯åŸºäº WebP å›¾ç‰‡æ ¼å¼çš„æµé‡ä¼˜åŒ–ï¼ˆä¸‹ï¼‰/">iOS å®¢æˆ·ç«¯åŸºäº WebP å›¾ç‰‡æ ¼å¼çš„æµé‡ä¼˜åŒ–ï¼ˆä¸‹ï¼‰</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/11/iOS å®¢æˆ·ç«¯åŸºäº WebP å›¾ç‰‡æ ¼å¼çš„æµé‡ä¼˜åŒ–ï¼ˆä¸Šï¼‰/">iOS å®¢æˆ·ç«¯åŸºäº WebP å›¾ç‰‡æ ¼å¼çš„æµé‡ä¼˜åŒ–ï¼ˆä¸Šï¼‰</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/WebP/">WebP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Widget/">Widget</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ä»-propertyè¯´èµ·/">ä»@propertyè¯´èµ·</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/iOSå®é™…åº”ç”¨/" style="font-size: 15px;">iOSå®é™…åº”ç”¨</a> <a href="/tags/OCåŸºç¡€/" style="font-size: 15px;">OCåŸºç¡€</a> <a href="/tags/iOS10-Widget/" style="font-size: 15px;">iOS10 Widget</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Â© <a href="/." rel="nofollow">Me.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>